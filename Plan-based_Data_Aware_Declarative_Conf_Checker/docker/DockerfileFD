# Start from the Fast Downward image as the base
FROM aibasel/downward:latest

# Add necessary files from the build context to the container
ADD file:481dd2da6de71525248eba186feeeafcc73cc956ade0a196a4e8b0c2424e74b9 /

# Update package list and install Python 3
RUN apt-get update && apt-get install --no-install-recommends -y python3 && rm -rf /var/lib/apt/lists/*

# Set the working directory
WORKDIR /workspace/downward/

# Copy files and directories from the build context to the container
COPY file:72c0b377c7dcc9e45582444b330d0c61191f0e521ebae8965ef9461e56d73512 .

# Copy binaries for release and debug builds
COPY dir:599a88997048b27b635bf958185ed2bda261d18c840dd58bff798599145d88fe ./builds/release/bin/
COPY dir:5dadf502190c02ba2e08813fca054ab0bae175cfbeecbfcad61afed839138f80 ./builds/debug/bin/

# Copy the driver directory
COPY dir:fdf56f97a8dfd0d63d6ce31cc4fdcade28359e8fc428a576038869a6d6499835 ./driver

# Copy SoPlex solver to the appropriate directory
COPY dir:273f37341ae6c37b2e5aa7872aef16c3a05dba2dd93d8879931a3d4fad328fa5 /opt/soplex

# Set environment variables for SoPlex
ENV DOWNWARD_SOPLEX_ROOT=/opt/soplex
ENV LD_LIBRARY_PATH=/opt/soplex/lib:$LD_LIBRARY_PATH

# Declare a volume for PDDL files (this will be mounted at runtime)
VOLUME ["/pddl"]

COPY Conformance_Checking/ /pddl/

# Create a script to run Fast Downward for all domain/problem pairs
COPY run_FD_all /usr/local/bin/run_FD_all
RUN chmod +x /usr/local/bin/run_FD_all

# Set the entry point to run the script
ENTRYPOINT ["/usr/local/bin/run_FD_all"]

# Default command (optional), this will be the default if no arguments are provided
CMD []
# Set the entry point to run Fast Downward with PDDL files
#ENTRYPOINT ["/workspace/downward/fast-downward.py"]

# Default command (optional), which can be overridden at runtime
#CMD ["/pddl/domain.pddl", "/pddl/problem.pddl", "--search", "astar(blind())"]

